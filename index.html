<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Photo & Video Sharing with Chat</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .container { max-width: 600px; margin: auto; }
    .card { border: 1px solid #ccc; padding: 15px; margin: 10px 0; border-radius: 10px; }
    #chatBox { height: 200px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; }
    img, video { max-width: 100%; margin-top: 10px; border-radius: 8px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>ðŸ“¸ My Sharing Site</h2>

    <!-- Auth Section -->
    <div class="card">
      <h3>Login / Register</h3>
      <input type="email" id="email" placeholder="Email"><br><br>
      <input type="password" id="password" placeholder="Password"><br><br>
      <button onclick="register()">Register</button>
      <button onclick="login()">Login</button>
      <button onclick="logout()">Logout</button>
      <p id="userInfo"></p>
    </div>

    <!-- Upload Section -->
    <div class="card">
      <h3>Upload Photo/Video</h3>
      <input type="file" id="fileInput"><br><br>
      <button onclick="uploadFile()">Upload</button>
      <div id="uploadStatus"></div>
    </div>

    <!-- Feed Section -->
    <div class="card">
      <h3>Feed</h3>
      <div id="feed"></div>
    </div>

    <!-- Chat Section -->
    <div class="card">
      <h3>Live Chat</h3>
      <div id="chatBox"></div>
      <input type="text" id="chatMessage" placeholder="Type a message...">
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    // âœ… Your Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBd0e1diSH5RnQbYjzBVgnnL-kGI55jTP8",
      authDomain: "my-kush-project-75267.firebaseapp.com",
      databaseURL: "https://my-kush-project-75267-default-rtdb.firebaseio.com",
      projectId: "my-kush-project-75267",
      storageBucket: "my-kush-project-75267.firebasestorage.app",
      messagingSenderId: "523289754861",
      appId: "1:523289754861:web:edf817f6210d3b194da0e4",
      measurementId: "G-5YWX6CHWGB"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const storage = firebase.storage();
    const db = firebase.database();

    // ========== AUTH ==========
    function register() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.createUserWithEmailAndPassword(email, password)
        .then(() => alert("Registered!"))
        .catch(err => alert(err.message));
    }

    function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.signInWithEmailAndPassword(email, password)
        .catch(err => alert(err.message));
    }

    function logout() {
      auth.signOut();
    }

    auth.onAuthStateChanged(user => {
      if (user) {
        document.getElementById("userInfo").innerText = "Logged in as " + user.email;
      } else {
        document.getElementById("userInfo").innerText = "Not logged in";
      }
    });

    // ========== UPLOAD ==========
    function uploadFile() {
      const file = document.getElementById("fileInput").files[0];
      if (!file) return alert("Choose a file first");

      const ref = storage.ref("uploads/" + Date.now() + "_" + file.name);
      ref.put(file).then(snapshot => {
        snapshot.ref.getDownloadURL().then(url => {
          db.ref("feed").push({ url, type: file.type });
          document.getElementById("uploadStatus").innerText = "Uploaded!";
        });
      }).catch(err => alert(err.message));
    }

    // ========== FEED ==========
    db.ref("feed").on("child_added", snap => {
      const data = snap.val();
      const feed = document.getElementById("feed");
      const div = document.createElement("div");

      if (data.type.startsWith("image/")) {
        div.innerHTML = `<img src="${data.url}" alt="photo">`;
      } else if (data.type.startsWith("video/")) {
        div.innerHTML = `<video controls src="${data.url}"></video>`;
      }

      feed.prepend(div);
    });

    // ========== CHAT ==========
    function sendMessage() {
      const msg = document.getElementById("chatMessage").value;
      const user = auth.currentUser;
      if (!msg) return;
      db.ref("chat").push({
        user: user ? user.email : "Anonymous",
        text: msg,
        time: Date.now()
      });
      document.getElementById("chatMessage").value = "";
    }

    db.ref("chat").on("child_added", snap => {
      const data = snap.val();
      const chatBox = document.getElementById("chatBox");
      const p = document.createElement("p");
      p.innerText = data.user + ": " + data.text;
      chatBox.appendChild(p);
      chatBox.scrollTop = chatBox.scrollHeight;
    });
  </script>
</body>
</html>